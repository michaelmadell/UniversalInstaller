; Example: Installer that runs PowerShell scripts
; This example shows how to execute PowerShell scripts during installation

[Setup]
AppName=PowerShell Deployment Tool
AppVersion=1.5.0
AppPublisher=IT Department
DefaultDirName={pf}\PSDeployTool
OutputBaseFilename=PSDeploySetup
PrivilegesRequired=yes
LicenseFile=license.txt
ShowLicense=yes

[Files]
; Main application files
Source=PSDeployTool.exe
DestDir={app}

; PowerShell scripts
Source=scripts\*.ps1
DestDir={app}\scripts

; Configuration files
Source=config\*.json
DestDir={app}\config

; Modules
Source=modules\*.*
DestDir={app}\modules
Recurse=yes

[Dirs]
Name={app}\logs
Name={app}\output
Name={commonappdata}\PSDeployTool

[Icons]
Name={group}\PowerShell Deployment Tool
Filename={app}\PSDeployTool.exe
WorkingDir={app}

Name={group}\Scripts Folder
Filename={app}\scripts

[Registry]
; Register installation path
Root=HKLM
Subkey=Software\ITDepartment\PSDeployTool
ValueName=InstallPath
ValueType=string
ValueData={app}

; Register in PATH (optional)
Root=HKLM
Subkey=System\CurrentControlSet\Control\Session Manager\Environment
ValueName=Path
ValueType=expandsz
ValueData=%Path%;{app}

[Run]
; Initialize configuration
Filename=powershell.exe
Parameters=-ExecutionPolicy Bypass -NoProfile -File "{app}\scripts\initialize.ps1" -InstallPath "{app}"
Description=Initializing configuration
WorkingDir={app}

; Import PowerShell module
Filename=powershell.exe
Parameters=-ExecutionPolicy Bypass -Command "Import-Module '{app}\modules\PSDeployTool.psd1'"
Description=Registering PowerShell module
Flags=nowait

; Create scheduled task (optional)
Filename=powershell.exe
Parameters=-ExecutionPolicy Bypass -File "{app}\scripts\create-task.ps1"
Description=Creating scheduled task
Flags=postinstall

[Components]
Name=core
Description=Core PowerShell tools
Fixed=yes

Name=modules
Description=Additional PowerShell modules

[Tasks]
Name=addtopath
Description=Add to system PATH environment variable
Checked=yes

Name=scheduledtask
Description=Create scheduled task for automated deployment
