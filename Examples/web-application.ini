; Example: Web Application Installer
; Installs a web application with IIS configuration

[Setup]
AppName=Corporate Web Portal
AppVersion=2.0.0
AppPublisher=Web Services Inc.
AppPublisherURL=https://www.webservices.com
DefaultDirName={pf}\WebPortal
OutputBaseFilename=WebPortalSetup
PrivilegesRequired=yes
LicenseFile=license.txt
ShowLicense=yes
ReadmeFile=deployment-guide.txt
ShowReadme=yes

[Files]
; Web application files
Source=wwwroot\*.*
DestDir={app}\wwwroot
Recurse=yes

; Application DLLs
Source=bin\*.dll
DestDir={app}\bin

; Configuration files
Source=appsettings.json
DestDir={app}

Source=web.config
DestDir={app}

; Database scripts
Source=database\*.sql
DestDir={app}\database

; Static content
Source=content\*.*
DestDir={app}\wwwroot\content
Recurse=yes

[Dirs]
Name={app}\logs
Name={app}\temp
Name={app}\uploads
Name={commonappdata}\WebPortal\sessions

[Registry]
; Application settings
Root=HKLM
Subkey=Software\WebServicesInc\WebPortal
ValueName=InstallPath
ValueType=string
ValueData={app}

Root=HKLM
Subkey=Software\WebServicesInc\WebPortal
ValueName=Version
ValueType=string
ValueData=2.0.0

Root=HKLM
Subkey=Software\WebServicesInc\WebPortal
ValueName=DatabaseServer
ValueType=string
ValueData=localhost

[Run]
; Setup IIS Application Pool
Filename={sys}\inetsrv\appcmd.exe
Parameters=add apppool /name:"WebPortal" /managedRuntimeVersion:"v4.0" /managedPipelineMode:"Integrated"
Description=Creating IIS Application Pool

; Create IIS Website
Filename={sys}\inetsrv\appcmd.exe
Parameters=add site /name:"WebPortal" /physicalPath:"{app}\wwwroot" /bindings:http/*:8080:
Description=Creating IIS Website

; Set Application Pool for Website
Filename={sys}\inetsrv\appcmd.exe
Parameters=set site "WebPortal" /[path='/'].applicationPool:"WebPortal"
Description=Configuring IIS Website

; Initialize database
Filename=sqlcmd.exe
Parameters=-S localhost -i "{app}\database\schema.sql"
Description=Initializing database
Flags=

; Set folder permissions
Filename=icacls.exe
Parameters="{app}\uploads" /grant "IIS_IUSRS:(OI)(CI)M"
Description=Setting folder permissions

; Start website
Filename={sys}\inetsrv\appcmd.exe
Parameters=start site "WebPortal"
Description=Starting web application
Flags=postinstall

[Components]
Name=webapp
Description=Web application files
Fixed=yes

Name=database
Description=Database scripts and tools

Name=docs
Description=Documentation and API reference

[Tasks]
Name=autostart
Description=Start website automatically
Checked=yes
